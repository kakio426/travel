<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ê°•ë¦‰ ê°€ì¡± íë§ ì—¬í–‰</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.3); }
        
        /* íƒ€ì„ë¼ì¸ ë ˆì´ì•„ì›ƒ: ì ê³¼ ì‹œê°„ì´ ì ˆëŒ€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì¶©ë¶„í•œ ê°„ê²©(80px) í™•ë³´ */
        .timeline-line { position: absolute; left: 80px; top: 0; bottom: 0; width: 2px; background: #e2e8f0; }
        .timeline-dot { position: absolute; left: 73px; top: 4px; width: 16px; height: 16px; border-radius: 9999px; border: 4px solid #3b82f6; background: white; z-index: 10; }
        
        .mission-pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const INITIAL_TRIP_DATA = {
            tripInfo: {
                title: "2026 ê°•ë¦‰ ê°€ì¡± íë§ ì—¬í–‰",
                dates: "2026.01.07 - 01.08",
                stay: "ì‹ ë¼ ëª¨ë…¸ê·¸ë¨ ê°•ë¦‰",
                family: "ì•„ë¹ (ì»¤í”¼), ì—„ë§ˆ(í† ì†ìŒì‹), 6ì„¸ ë”¸(ë™ë¬¼/ì•¡í‹°ë¹„í‹°)"
            },
            itinerary: [
                {
                    day: 1, date: "1ì›” 7ì¼ (í™”)",
                    schedule: [
                        { id: "d1-lunch", time: "12:00", category: "meal", isFixed: true, selectedOptionIndex: 0, options: [{ title: "ì´ˆë‹¹ ìˆœë‘ë¶€ ë§ˆì„", desc: "ì—„ë§ˆëŠ” ì–¼í° ì „ê³¨, ë”¸ì€ í•˜ì–€ ìˆœë‘ë¶€", tags: ["í† ì†ì ", "ì•„ì´ì¶”ì²œ"], place: "ì´ˆë‹¹ë™" }] },
                        { id: "d1-snack", time: "13:30", category: "shopping", isFixed: true, mission: true, selectedOptionIndex: 0, options: [{ title: "ê°•ë¦‰ìƒŒë“œ ì´ˆë‹¹ì§ì˜ì ", desc: "âš ï¸ í’ˆì ˆ ë°©ì§€! ë¯¸ë¦¬ êµ¬ë§¤ ê¶Œì¥", tags: ["ë¯¸ì…˜í•„ìˆ˜", "ì„ ë¬¼"], place: "ì´ˆë‹¹ë™" }] },
                        { id: "d1-coffee", time: "14:00", category: "coffee", isFixed: false, selectedOptionIndex: 0, options: [
                            { title: "ë³´í—¤ë¯¸ì•ˆ ë°•ì´ì¶” ì»¤í”¼", desc: "ëŒ€í•œë¯¼êµ­ 1ì„¸ëŒ€ ëª…ì¥ì˜ í•¸ë“œë“œë¦½", tags: ["ì•„ë¹ ì¶”ì²œ", "ì¥ì¸ì „í†µ"] },
                            { title: "ë°”ìš°ì¹´í˜ (ë³¸ì )", desc: "íˆ‡ë§ˆë£¨ ì–´ë¨¸ë‹ˆ ìš´ì˜, í‘ì„ìë¼ë–¼", tags: ["ì‹œê·¸ë‹ˆì²˜", "ì¸ê¸°"] },
                            { title: "ì¹´í˜ ê¸°ì™€", desc: "ê³ ì¦ˆë„‰í•œ í•œì˜¥ ê°ì„±", tags: ["ì—„ë§ˆì¶”ì²œ", "í•œì˜¥"] }
                        ]},
                        { id: "d1-checkin", time: "16:00", category: "stay", isFixed: true, selectedOptionIndex: 0, options: [{ title: "ì‹ ë¼ ëª¨ë…¸ê·¸ë¨ ì²´í¬ì¸", desc: "ì˜¨ìˆ˜í’€ ìˆ˜ì˜ (3ë¶€ ì´ìš© ì¶”ì²œ)", tags: ["í˜¸í…”", "ìˆ˜ì˜"], place: "ì†¡ì •ë™" }] },
                        { id: "d1-market", time: "18:30", category: "activity", isFixed: true, mission: true, selectedOptionIndex: 0, options: [{ title: "ê°•ë¦‰ ì¤‘ì•™ì‹œì¥", desc: "ë² ë‹ˆë‹­ê°•ì •, ì–´ë¬µê³ ë¡œì¼€ í•„ìˆ˜", tags: ["ì‹œì¥êµ¬ê²½", "ë¯¸ì…˜í•„ìˆ˜"], place: "ì„±ë‚¨ë™" }] },
                    ]
                },
                {
                    day: 2, date: "1ì›” 8ì¼ (ìˆ˜)",
                    schedule: [
                        { id: "d2-activity", time: "10:00", category: "activity", isFixed: false, selectedOptionIndex: 0, options: [{ title: "ìì—°ì•„ë†€ì", desc: "ì‹¤ë‚´ ìƒíƒœì²´í—˜, ë™ë¬¼ ë¨¹ì´ì£¼ê¸°", tags: ["ì•„ì´ìµœì• ", "ì‹¤ë‚´"] }, { title: "ê²½í¬ ì•„ì¿ ì•„ë¦¬ì›€", desc: "ë”°ëœ»í•œ ì‹¤ë‚´ ê´€ëŒ", tags: ["ì‹¤ë‚´", "êµìœ¡"] }] },
                        { id: "d2-lunch", time: "12:30", category: "meal", isFixed: false, selectedOptionIndex: 0, options: [{ title: "í¬ë‚¨ì‚¬ê³¨ì˜¹ì‹¬ì´", desc: "ì•ˆ ë§¤ìš´ ì«€ë“ ì˜¹ì‹¬ì´", tags: ["í† ì†ì ", "ë‹´ë°±"] }, { title: "ê°•ë¦‰ ë¶ˆê³ ê¸°", desc: "ë‹¬ì½¤ íŒŒë¶ˆê³ ê¸°", tags: ["ì•„ì´ë°¥ë„ë‘‘", "ë¡œì»¬"] }] },
                        { id: "d2-coffee", time: "14:30", category: "coffee", isFixed: false, selectedOptionIndex: 0, options: [{ title: "í…Œë¼ë¡œì‚¬ ë³¸ì ", desc: "ì›…ì¥í•œ ì»¤í”¼ ê³µì¥", tags: ["ì•„ë¹ í•„ìˆ˜", "ì›…ì¥"] }, { title: "í…Œë¼ë¡œì‚¬ ê²½í¬í˜¸ìˆ˜", desc: "í˜¸ìˆ˜ ë·° ë¶ì¹´í˜", tags: ["ì•„ì´ë™ë°˜", "ì—¬ìœ "] }] },
                    ]
                }
            ]
        };

        function App() {
            const [trip, setTrip] = useState(INITIAL_TRIP_DATA);
            const [currentDay, setCurrentDay] = useState(0);
            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || "");
            const [showSettings, setShowSettings] = useState(false);
            const [showSummary, setShowSummary] = useState(false);
            const [isChatOpen, setIsChatOpen] = useState(false);
            const [chatMessages, setChatMessages] = useState([{ role: 'ai', text: 'ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ¤–' }]);
            const [userInput, setUserInput] = useState("");
            const [isTyping, setIsTyping] = useState(false);
            const [aiTip, setAiTip] = useState({ show: false, content: "" });

            // ì•„ì´ì½˜ ë¦¬ëœë”ë§ ë³´ì¥
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [currentDay, trip, showSettings, isChatOpen, aiTip]);

            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('gemini_api_key', key);
                setShowSettings(false);
            };

            const openNaver = (title) => {
                window.open(`https://search.naver.com/search.naver?query=${encodeURIComponent(title)}`, '_blank');
            };

            const callGemini = async (prompt, system) => {
                if (!apiKey) throw new Error("KEY_MISSING");
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: system }] }
                    })
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text;
            };

            const handleSend = async () => {
                if (!userInput.trim()) return;
                const txt = userInput;
                setUserInput("");
                setChatMessages(prev => [...prev, { role: 'user', text: txt }]);
                setIsTyping(true);
                try {
                    const ans = await callGemini(txt, "ë‹¹ì‹ ì€ ê°•ë¦‰ ì—¬í–‰ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì¹œì ˆí•˜ê³  ê°„ê²°í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”.");
                    setChatMessages(prev => [...prev, { role: 'ai', text: ans }]);
                } catch (e) {
                    setChatMessages(prev => [...prev, { role: 'ai', text: "API í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”." }]);
                } finally { setIsTyping(false); }
            };

            const handleAiTip = async (e, title, desc) => {
                e.stopPropagation();
                setAiTip({ show: true, content: "AIê°€ ê¿€íŒì„ ìƒê° ì¤‘ì…ë‹ˆë‹¤..." });
                try {
                    const ans = await callGemini(`'${title}'(${desc}) ë°©ë¬¸ ì‹œ 6ì„¸ ë”¸ì´ ìˆëŠ” ê°€ì¡±ì„ ìœ„í•œ ì§§ì€ ê¿€íŒ 1ê°œë§Œ ì•Œë ¤ì¤˜.`, "ê°•ë¦‰ ì—¬í–‰ ê°€ì´ë“œ");
                    setAiTip({ show: true, content: ans });
                } catch (e) {
                    setAiTip({ show: true, content: "ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!" });
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 relative shadow-2xl overflow-x-hidden">
                    {/* Header */}
                    <header className="bg-blue-600 text-white p-6 rounded-b-[2.5rem] shadow-lg">
                        <div className="flex justify-between items-center mb-4">
                            <h1 className="text-xl font-bold">{trip.tripInfo.title}</h1>
                            <button onClick={() => setShowSettings(true)} className="p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors">
                                <i data-lucide="settings" className="w-5 h-5"></i>
                            </button>
                        </div>
                        <div className="flex gap-2 overflow-x-auto no-scrollbar">
                            <span className="text-[10px] bg-blue-500/50 px-3 py-1 rounded-full border border-blue-400 whitespace-nowrap">ğŸ‘¨ ì•„ë¹ : ì»¤í”¼</span>
                            <span className="text-[10px] bg-pink-500/50 px-3 py-1 rounded-full border border-pink-400 whitespace-nowrap">ğŸ‘© ì—„ë§ˆ: í† ì†</span>
                            <span className="text-[10px] bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full font-bold whitespace-nowrap">ğŸ‘§ ë”¸: ë™ë¬¼</span>
                        </div>
                    </header>

                    {/* Tabs */}
                    <div className="flex p-4 gap-3 sticky top-0 bg-slate-50/90 backdrop-blur-md z-30">
                        {[0, 1].map(idx => (
                            <button key={idx} onClick={() => setCurrentDay(idx)} className={`flex-1 py-3 rounded-2xl font-bold text-sm shadow-sm transition-all ${currentDay === idx ? 'bg-blue-600 text-white scale-105' : 'bg-white text-gray-400'}`}>
                                Day {idx + 1} ({trip.itinerary[idx].date.split('(')[1].replace(')', '')})
                            </button>
                        ))}
                    </div>

                    {/* Timeline */}
                    <div className="px-6 pb-24 relative">
                        <div className="timeline-line"></div>
                        {trip.itinerary[currentDay].schedule.map((item) => {
                            const selected = item.options[item.selectedOptionIndex];
                            return (
                                <div key={item.id} className="relative pl-24 pb-10"> {/* íŒ¨ë”© ì¦ê°€ */}
                                    <div className="timeline-dot"></div>
                                    <span className="absolute left-0 top-1 text-xs font-bold text-gray-400 w-[70px] text-right pr-4">{item.time}</span>
                                    
                                    <div onClick={() => openNaver(selected.title)} className={`glass-card rounded-3xl p-5 shadow-sm active:scale-95 transition-transform cursor-pointer ${item.mission ? 'mission-pulse border-red-200' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <h3 className="font-bold text-gray-800 flex items-center gap-1">
                                                {selected.title} <i data-lucide="search" className="w-3 h-3 text-gray-300"></i>
                                            </h3>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-3">{selected.desc}</p>
                                        <div className="flex flex-wrap gap-1 mb-4">
                                            {selected.tags.map(tag => <span key={tag} className="text-[10px] px-2 py-0.5 bg-slate-100 text-slate-500 rounded-md">#{tag}</span>)}
                                        </div>
                                        <button 
                                            onClick={(e) => handleAiTip(e, selected.title, selected.desc)} 
                                            className="w-full py-2 bg-blue-50 text-blue-600 text-xs font-bold rounded-xl flex items-center justify-center gap-2 hover:bg-blue-100"
                                        >
                                            <i data-lucide="sparkles" className="w-3 h-3"></i> AI ê¿€íŒ ë³´ê¸°
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Floating Buttons */}
                    <div className="fixed bottom-6 right-6 flex flex-col gap-3 z-40">
                        <button onClick={() => setShowSummary(true)} className="w-14 h-14 bg-gray-800 text-white rounded-full shadow-xl flex items-center justify-center hover:bg-gray-700 transition-all"><i data-lucide="list-checks"></i></button>
                        <button onClick={() => setIsChatOpen(true)} className="w-14 h-14 bg-blue-600 text-white rounded-full shadow-xl flex items-center justify-center relative hover:bg-blue-700 transition-all"><i data-lucide="sparkles"></i></button>
                    </div>

                    {/* AI Tip Popup */}
                    {aiTip.show && (
                        <div className="fixed inset-x-6 bottom-24 z-50 bg-gray-900/95 text-white p-5 rounded-3xl shadow-2xl animate-bounce-in">
                            <div className="flex justify-between items-start mb-2">
                                <span className="text-xs font-bold text-yellow-400 flex items-center gap-1"><i data-lucide="lightbulb" className="w-3 h-3"></i> AI ê¿€íŒ</span>
                                <button onClick={() => setAiTip({ show: false, content: "" })} className="text-gray-400 hover:text-white"><i data-lucide="x" className="w-4 h-4"></i></button>
                            </div>
                            <p className="text-sm leading-relaxed">{aiTip.content}</p>
                        </div>
                    )}

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-6">
                            <div className="bg-white rounded-[2rem] p-8 w-full max-w-sm">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="key" className="text-blue-600"></i> API í‚¤ ì„¤ì •</h2>
                                <p className="text-xs text-gray-500 mb-4">ê°œì¸ API í‚¤ë¥¼ ë“±ë¡í•˜ë©´ AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" className="w-full px-4 py-3 bg-slate-100 rounded-xl mb-4 text-sm outline-none focus:ring-2 focus:ring-blue-500" />
                                <button onClick={() => saveApiKey(apiKey)} className="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg">ì €ì¥í•˜ê¸°</button>
                                <button onClick={() => setShowSettings(false)} className="w-full py-3 mt-2 text-gray-400 text-sm">ë‹«ê¸°</button>
                            </div>
                        </div>
                    )}

                    {/* Chat Modal */}
                    {isChatOpen && (
                        <div className="fixed inset-0 z-[110] bg-white flex flex-col">
                            <div className="bg-blue-600 p-6 flex justify-between items-center text-white">
                                <div className="flex items-center gap-2">
                                    <div className="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i data-lucide="sparkles"></i></div>
                                    <span className="font-bold">AI ì—¬í–‰ ë¹„ì„œ</span>
                                </div>
                                <button onClick={() => setIsChatOpen(false)}><i data-lucide="x" className="w-6 h-6"></i></button>
                            </div>
                            <div className="flex-1 p-6 space-y-4 overflow-y-auto bg-slate-50">
                                {chatMessages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`p-4 rounded-2xl text-sm leading-relaxed max-w-[85%] ${m.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-white shadow-sm text-gray-700 rounded-tl-none border border-gray-100'}`}>{m.text}</div>
                                    </div>
                                ))}
                                {isTyping && <div className="text-xs text-gray-400 animate-pulse">AIê°€ ë‹µë³€ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>}
                            </div>
                            <div className="p-4 border-t flex gap-2 bg-white">
                                <input type="text" value={userInput} onChange={e => setUserInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleSend()} placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ë¬¼ì–´ë³´ì„¸ìš”..." className="flex-1 px-4 py-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500" />
                                <button onClick={handleSend} className="p-3 bg-blue-600 text-white rounded-xl shadow-md"><i data-lucide="send" className="w-5 h-5"></i></button>
                            </div>
                        </div>
                    )}

                    {/* Summary Modal */}
                    {showSummary && (
                        <div className="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-6">
                            <div className="bg-white rounded-[2rem] p-8 w-full max-w-sm max-h-[80vh] overflow-y-auto shadow-2xl">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2 border-b pb-2"><i data-lucide="history" className="text-blue-600"></i> ì¼ì • í•œëˆˆì— ë³´ê¸°</h2>
                                {trip.itinerary.map(day => (
                                    <div key={day.day} className="mb-6">
                                        <h4 className="font-bold text-blue-600 mb-3">{day.date}</h4>
                                        <div className="space-y-3">
                                            {day.schedule.map(s => (
                                                <div key={s.id} className="flex gap-4 text-sm items-center">
                                                    <span className="text-gray-400 font-mono w-10 shrink-0 text-xs">{s.time}</span>
                                                    <span className="text-gray-700 font-medium">{s.options[s.selectedOptionIndex].title}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                                <button onClick={() => setShowSummary(false)} className="w-full py-4 bg-gray-800 text-white rounded-2xl font-bold mt-4 shadow-lg">ë‹«ê¸°</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
