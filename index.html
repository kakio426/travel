<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Í∞ïÎ¶â Í∞ÄÏ°± Ïó¨Ìñâ (AI Edition)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
        
        .timeline-line { position: absolute; left: 80px; top: 0; bottom: 0; width: 2px; background: #e2e8f0; }
        .timeline-dot { position: absolute; left: 73px; top: 4px; width: 16px; height: 16px; border-radius: 9999px; border: 4px solid #3b82f6; background: white; z-index: 10; }
        
        .mission-pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞
        const INITIAL_TRIP_DATA = {
            tripInfo: {
                title: "2026 Í∞ïÎ¶â Í∞ÄÏ°± ÌûêÎßÅ Ïó¨Ìñâ",
                dates: "2026.01.07 - 01.08",
                family: "ÏïÑÎπ†(Ïª§Ìîº), ÏóÑÎßà(ÌÜ†ÏÜçÏùåÏãù), 6ÏÑ∏ Îî∏(ÎèôÎ¨º/Ïï°Ìã∞ÎπÑÌã∞)"
            },
            itinerary: [
                {
                    day: 1, date: "1Ïõî 7Ïùº (Ìôî)",
                    schedule: [
                        { id: "d1-lunch", time: "12:00", category: "ÏãùÏÇ¨", isFixed: true, selectedOptionIndex: 0, options: [{ title: "Ï¥àÎãπ ÏàúÎëêÎ∂Ä ÎßàÏùÑ", desc: "ÏóÑÎßàÎäî ÏñºÌÅ∞ Ï†ÑÍ≥®, Îî∏ÏùÄ ÌïòÏñÄ ÏàúÎëêÎ∂Ä", tags: ["ÌÜ†ÏÜçÏ†Å", "ÏïÑÏù¥Ï∂îÏ≤ú"], place: "Ï¥àÎãπÎèô" }] },
                        { id: "d1-snack", time: "13:30", category: "ÏáºÌïë", isFixed: true, mission: true, selectedOptionIndex: 0, options: [{ title: "Í∞ïÎ¶âÏÉåÎìú Ï¥àÎãπÏßÅÏòÅÏ†ê", desc: "‚ö†Ô∏è ÌíàÏ†à Î∞©ÏßÄ! ÎØ∏Î¶¨ Íµ¨Îß§ Í∂åÏû•", tags: ["ÎØ∏ÏÖòÌïÑÏàò", "ÏÑ†Î¨º"], place: "Ï¥àÎãπÎèô" }] },
                        { id: "d1-coffee", time: "14:00", category: "Ïπ¥Ìéò", isFixed: false, selectedOptionIndex: 0, options: [
                            { title: "Î≥¥Ìó§ÎØ∏Ïïà Î∞ïÏù¥Ï∂î Ïª§Ìîº", desc: "ÎåÄÌïúÎØºÍµ≠ 1ÏÑ∏ÎåÄ Î™ÖÏû•Ïùò Ìï∏ÎìúÎìúÎ¶Ω", tags: ["ÏïÑÎπ†Ï∂îÏ≤ú", "Ïû•Ïù∏Ï†ÑÌÜµ"] },
                            { title: "Î∞îÏö∞Ïπ¥Ìéò (Î≥∏Ï†ê)", desc: "ÌàáÎßàÎ£® Ïñ¥Î®∏Îãà Ïö¥ÏòÅ, ÌùëÏûÑÏûêÎùºÎñº", tags: ["ÏãúÍ∑∏ÎãàÏ≤ò", "Ïù∏Í∏∞"] }
                        ]},
                        { id: "d1-checkin", time: "16:00", category: "ÏàôÏÜå", isFixed: true, selectedOptionIndex: 0, options: [{ title: "Ïã†Îùº Î™®ÎÖ∏Í∑∏Îû®", desc: "Ïò®ÏàòÌíÄ ÏàòÏòÅ (3Î∂Ä Ïù¥Ïö© Ï∂îÏ≤ú)", tags: ["Ìò∏ÌÖî", "ÏàòÏòÅ"], place: "ÏÜ°Ï†ïÎèô" }] },
                        { id: "d1-market", time: "18:30", category: "Í¥ÄÍ¥ë", isFixed: true, mission: true, selectedOptionIndex: 0, options: [{ title: "Í∞ïÎ¶â Ï§ëÏïôÏãúÏû•", desc: "Î≤†ÎãàÎã≠Í∞ïÏ†ï, Ïñ¥Î¨µÍ≥†Î°úÏºÄ ÌïÑÏàò", tags: ["ÏãúÏû•Íµ¨Í≤Ω", "ÎØ∏ÏÖòÌïÑÏàò"], place: "ÏÑ±ÎÇ®Îèô" }] },
                    ]
                },
                {
                    day: 2, date: "1Ïõî 8Ïùº (Ïàò)",
                    schedule: [
                        { id: "d2-activity", time: "10:00", category: "Ïï°Ìã∞ÎπÑÌã∞", isFixed: false, selectedOptionIndex: 0, options: [{ title: "ÏûêÏó∞ÏïÑÎÜÄÏûê", desc: "Ïã§ÎÇ¥ ÏÉùÌÉúÏ≤¥Ìóò, ÎèôÎ¨º Î®πÏù¥Ï£ºÍ∏∞", tags: ["ÏïÑÏù¥ÏµúÏï†", "Ïã§ÎÇ¥"] }, { title: "Í≤ΩÌè¨ ÏïÑÏø†ÏïÑÎ¶¨ÏõÄ", desc: "Îî∞ÎúªÌïú Ïã§ÎÇ¥ Í¥ÄÎûå", tags: ["Ïã§ÎÇ¥", "ÍµêÏú°"] }] },
                        { id: "d2-lunch", time: "12:30", category: "ÏãùÏÇ¨", isFixed: false, selectedOptionIndex: 0, options: [{ title: "Ìè¨ÎÇ®ÏÇ¨Í≥®ÏòπÏã¨Ïù¥", desc: "Ïïà Îß§Ïö¥ Ï´ÄÎìù ÏòπÏã¨Ïù¥", tags: ["ÌÜ†ÏÜçÏ†Å", "Îã¥Î∞±"] }, { title: "Í∞ïÎ¶â Î∂àÍ≥†Í∏∞", desc: "Îã¨ÏΩ§ ÌååÎ∂àÍ≥†Í∏∞", tags: ["ÏïÑÏù¥Î∞•ÎèÑÎëë", "Î°úÏª¨"] }] },
                        { id: "d2-coffee", time: "14:30", category: "Ïπ¥Ìéò", isFixed: false, selectedOptionIndex: 0, options: [{ title: "ÌÖåÎùºÎ°úÏÇ¨ Î≥∏Ï†ê", desc: "ÏõÖÏû•Ìïú Ïª§Ìîº Í≥µÏû•", tags: ["ÏïÑÎπ†ÌïÑÏàò", "ÏõÖÏû•"] }, { title: "ÌÖåÎùºÎ°úÏÇ¨ Í≤ΩÌè¨Ìò∏Ïàò", desc: "Ìò∏Ïàò Î∑∞ Î∂ÅÏπ¥Ìéò", tags: ["ÏïÑÏù¥ÎèôÎ∞ò", "Ïó¨Ïú†"] }] },
                    ]
                }
            ]
        };

        function App() {
            const [trip, setTrip] = useState(INITIAL_TRIP_DATA);
            const [currentDay, setCurrentDay] = useState(0);
            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || "");
            
            // UI States
            const [showSettings, setShowSettings] = useState(false);
            const [showSummary, setShowSummary] = useState(false);
            const [isChatOpen, setIsChatOpen] = useState(false);
            
            // Chat Logic
            const [chatMessages, setChatMessages] = useState([{ role: 'ai', text: 'ÏïàÎÖïÌïòÏÑ∏Ïöî! 2026ÎÖÑ Í∞ïÎ¶â Ïó¨Ìñâ Í∞ÄÏù¥ÎìúÏûÖÎãàÎã§. ÏùºÏ†ï Î≥ÄÍ≤ΩÏù¥ÎÇò Ï∂îÏ≤úÏù¥ ÌïÑÏöîÌïòÎ©¥ ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî! ü§ñ' }]);
            const [userInput, setUserInput] = useState("");
            const [isTyping, setIsTyping] = useState(false);

            // Replacement Logic (Magic Wand)
            const [isReplacing, setIsReplacing] = useState(false);
            const [replacementModal, setReplacementModal] = useState({ show: false, dayIndex: 0, scheduleId: null, alternatives: [] });

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [currentDay, trip, showSettings, isChatOpen, replacementModal]);

            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('gemini_api_key', key);
                setShowSettings(false);
            };

            // --- Gemini API Call Wrapper ---
            const callGemini = async (prompt, system) => {
                if (!apiKey) {
                    setShowSettings(true);
                    throw new Error("API ÌÇ§Î•º Î®ºÏ†Ä ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.");
                }
                
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: system }] },
                            generationConfig: { responseMimeType: "application/json" } // JSON Í∞ïÏ†ú
                        })
                    });
                    
                    const data = await res.json();
                    if (data.error) throw new Error(data.error.message);
                    return JSON.parse(data.candidates[0].content.parts[0].text);
                } catch (e) {
                    console.error("Gemini API Error:", e);
                    throw e;
                }
            };

            // --- Feature 1: AI Recommend & Replace (Magic Wand) ---
            const handleRecommend = async (dayIdx, scheduleItem) => {
                setIsReplacing(true);
                const currentPlace = scheduleItem.options[scheduleItem.selectedOptionIndex];
                
                const prompt = `
                    ÌòÑÏû¨ ÏùºÏ†ï: ${trip.itinerary[dayIdx].date} ${scheduleItem.time}
                    ÌòÑÏû¨ Ïû•ÏÜå: ${currentPlace.title} (${currentPlace.desc})
                    Ïπ¥ÌÖåÍ≥†Î¶¨: ${scheduleItem.category}
                    Í∞ÄÏ°± Íµ¨ÏÑ±: ${trip.tripInfo.family}
                    
                    ÏöîÏ≤≠: ÏúÑ Ïû•ÏÜåÎ•º ÎåÄÏ≤¥Ìï† Ïàò ÏûàÎäî, Í∞ïÎ¶âÏùò Îã§Î•∏ ÌõåÎ•≠Ìïú Ïû•ÏÜå 3Í≥≥ÏùÑ Ï∂îÏ≤úÌï¥Ï§ò.
                    Ï°∞Í±¥:
                    1. ÌòÑÏû¨ Ïû•ÏÜåÏôÄ Îã§Î•∏ Í≥≥Ïù¥Ïñ¥Ïïº Ìï®.
                    2. 6ÏÑ∏ ÏïÑÏù¥ÏôÄ Ìï®ÍªòÌïòÍ∏∞ Ï¢ãÏùÄ Í≥≥ Ìè¨Ìï®.
                    3. JSON ÌòïÏãùÏúºÎ°úÎßå ÏùëÎãµÌï† Í≤É.
                    
                    Output Schema:
                    [
                        { "title": "Ïû•ÏÜåÎ™Ö", "desc": "ÌïúÏ§Ñ ÏÑ§Î™Ö", "tags": ["ÌÉúÍ∑∏1", "ÌÉúÍ∑∏2"] },
                        ...
                    ]
                `;

                try {
                    const alternatives = await callGemini(prompt, "You are a travel assistant. Output strict JSON array.");
                    setReplacementModal({
                        show: true,
                        dayIndex: dayIdx,
                        scheduleId: scheduleItem.id,
                        alternatives: alternatives
                    });
                } catch (e) {
                    alert(e.message || "Ï∂îÏ≤úÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.");
                } finally {
                    setIsReplacing(false);
                }
            };

            const applyReplacement = (newOption) => {
                const { dayIndex, scheduleId } = replacementModal;
                const newTrip = { ...trip };
                
                // Ìï¥Îãπ ÏùºÏ†ï Ï∞æÍ∏∞ Î∞è ÏóÖÎç∞Ïù¥Ìä∏
                const schedule = newTrip.itinerary[dayIndex].schedule;
                const itemIndex = schedule.findIndex(s => s.id === scheduleId);
                
                if (itemIndex !== -1) {
                    // Í∏∞Ï°¥ ÏòµÏÖò Î¶¨Ïä§Ìä∏Ïóê ÏÉà ÏòµÏÖò Ï∂îÍ∞ÄÌïòÍ≥† Î∞îÎ°ú ÏÑ†ÌÉù
                    schedule[itemIndex].options.push(newOption);
                    schedule[itemIndex].selectedOptionIndex = schedule[itemIndex].options.length - 1;
                    
                    // ÌÉúÍ∑∏Ïóê 'AIÏ∂îÏ≤ú' ÏûêÎèô Ï∂îÍ∞Ä
                    if (!newOption.tags.includes("AIÏ∂îÏ≤ú")) {
                        schedule[itemIndex].options[schedule[itemIndex].selectedOptionIndex].tags.unshift("AIÏ∂îÏ≤ú");
                    }
                }

                setTrip(newTrip);
                setReplacementModal({ ...replacementModal, show: false });
                
                // Ï±ÑÌåÖÏ∞ΩÏóê ÏïåÎ¶º Ï∂îÍ∞Ä
                setChatMessages(prev => [...prev, { role: 'ai', text: `‚úÖ [${newOption.title}]Î°ú ÏùºÏ†ïÏùÑ Î≥ÄÍ≤ΩÌñàÏäµÎãàÎã§!` }]);
            };

            // --- Feature 2: Chat & General Query ---
            // ÏùºÎ∞ò ÌÖçÏä§Ìä∏ Î™®ÎìúÏùò API Ìò∏Ï∂ú (Ï±ÑÌåÖÏö©)
            const callGeminiText = async (prompt, system) => {
                if (!apiKey) return "API ÌÇ§ ÏÑ§Ï†ïÏùÑ Î®ºÏ†Ä Ìï¥Ï£ºÏÑ∏Ïöî!";
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: system }] }
                    })
                });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            };

            const handleSendChat = async () => {
                if (!userInput.trim()) return;
                const txt = userInput;
                setUserInput("");
                setChatMessages(prev => [...prev, { role: 'user', text: txt }]);
                setIsTyping(true);

                // ÌòÑÏû¨ ÏùºÏ†ï Ï†ïÎ≥¥Î•º Ïª®ÌÖçÏä§Ìä∏Î°ú Ï†úÍ≥µ
                const context = JSON.stringify(trip.itinerary);
                const systemPrompt = `
                    ÎãπÏã†ÏùÄ Í∞ïÎ¶â Ïó¨Ìñâ Í∞ÄÏù¥ÎìúÏûÖÎãàÎã§.
                    ÌòÑÏû¨ Ïó¨ÌñâÍ∞ùÏùò ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞Îäî Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§: ${context}
                    
                    ÏÇ¨Ïö©ÏûêÏùò ÏßàÎ¨∏Ïóê ÏπúÏ†àÌïòÍ≤å ÎãµÌïòÏÑ∏Ïöî.
                    ÎßåÏïΩ ÏÇ¨Ïö©ÏûêÍ∞Ä "ÏùºÏ†ïÏùÑ Ï∂îÏ≤úÌï¥Ï§ò" ÌòπÏùÄ "Î∞îÍøîÏ§ò"ÎùºÍ≥† ÌïòÎ©¥,
                    "ÏùºÏ†ï Ïπ¥ÎìúÏùò [ÎßàÏà†Î¥â ÏïÑÏù¥ÏΩò]ÏùÑ ÎàåÎü¨Î≥¥ÏÑ∏Ïöî! Ï†úÍ∞Ä Îî± ÎßûÎäî Ïû•ÏÜåÎ•º Ï∞æÏïÑÎìúÎ¶¥Í≤åÏöî."ÎùºÍ≥† ÏïàÎÇ¥Ìï¥Ï£ºÏÑ∏Ïöî.
                `;

                try {
                    const ans = await callGeminiText(txt, systemPrompt);
                    setChatMessages(prev => [...prev, { role: 'ai', text: ans }]);
                } catch (e) {
                    setChatMessages(prev => [...prev, { role: 'ai', text: "Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§." }]);
                } finally {
                    setIsTyping(false);
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 relative shadow-2xl overflow-x-hidden">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 rounded-b-[2.5rem] shadow-lg sticky top-0 z-20">
                        <div className="flex justify-between items-center mb-4">
                            <div>
                                <h1 className="text-xl font-bold">{trip.tripInfo.title}</h1>
                                <p className="text-xs text-blue-100 opacity-80">{trip.tripInfo.dates}</p>
                            </div>
                            <button onClick={() => setShowSettings(true)} className="p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors">
                                <i data-lucide="settings" className="w-5 h-5"></i>
                            </button>
                        </div>
                        <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                            {trip.tripInfo.family.split(',').map((fam, i) => (
                                <span key={i} className="text-[10px] bg-white/20 px-3 py-1 rounded-full border border-white/10 whitespace-nowrap backdrop-blur-sm">
                                    {fam.trim()}
                                </span>
                            ))}
                        </div>
                    </header>

                    {/* Day Tabs */}
                    <div className="flex p-4 gap-3 bg-slate-50 z-10">
                        {trip.itinerary.map((day, idx) => (
                            <button key={idx} onClick={() => setCurrentDay(idx)} 
                                className={`flex-1 py-3 rounded-2xl font-bold text-sm shadow-sm transition-all flex flex-col items-center justify-center gap-1
                                ${currentDay === idx ? 'bg-white text-blue-600 ring-2 ring-blue-500' : 'bg-white text-gray-400 border border-gray-100'}`}>
                                <span>Day {day.day}</span>
                                <span className="text-xs font-normal opacity-80">{day.date.split('(')[1].replace(')', '')}</span>
                            </button>
                        ))}
                    </div>

                    {/* Timeline */}
                    <div className="px-6 pb-24 relative min-h-[500px]">
                        <div className="timeline-line"></div>
                        {trip.itinerary[currentDay].schedule.map((item) => {
                            const selected = item.options[item.selectedOptionIndex];
                            return (
                                <div key={item.id} className="relative pl-24 pb-8 group">
                                    {/* Timeline Dot & Time */}
                                    <div className="timeline-dot shadow-sm group-hover:scale-110 transition-transform"></div>
                                    <span className="absolute left-0 top-1 text-xs font-bold text-gray-500 w-[70px] text-right pr-4 font-mono">{item.time}</span>
                                    
                                    {/* Card */}
                                    <div className={`glass-card rounded-3xl p-5 shadow-sm hover:shadow-md transition-all relative overflow-hidden ${item.mission ? 'border-l-4 border-l-red-400' : ''}`}>
                                        
                                        {/* Badge */}
                                        <div className="flex justify-between items-start mb-2">
                                            <span className={`text-[10px] font-bold px-2 py-1 rounded-md mb-2 inline-block
                                                ${item.category === 'ÏãùÏÇ¨' ? 'bg-orange-100 text-orange-600' : 
                                                  item.category === 'Ïπ¥Ìéò' ? 'bg-brown-100 text-stone-600' : 
                                                  item.category === 'ÏàôÏÜå' ? 'bg-purple-100 text-purple-600' : 'bg-blue-100 text-blue-600'}`}>
                                                {item.category}
                                            </span>
                                            
                                            {/* AI Magic Wand Button */}
                                            <button 
                                                onClick={() => handleRecommend(currentDay, item)}
                                                disabled={isReplacing}
                                                className="p-2 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 active:scale-95 transition-all"
                                                title="AIÎ°ú Îã§Î•∏ Ïû•ÏÜå Ï∂îÏ≤úÎ∞õÍ∏∞"
                                            >
                                                {isReplacing ? <i data-lucide="loader-2" className="w-4 h-4 animate-spin"></i> : <i data-lucide="wand-2" className="w-4 h-4"></i>}
                                            </button>
                                        </div>

                                        <h3 className="font-bold text-gray-800 text-lg mb-1">{selected.title}</h3>
                                        <p className="text-sm text-gray-600 mb-3 leading-snug">{selected.desc}</p>
                                        
                                        <div className="flex flex-wrap gap-1">
                                            {selected.tags.map((tag, i) => (
                                                <span key={i} className={`text-[10px] px-2 py-0.5 rounded-md ${tag === 'AIÏ∂îÏ≤ú' ? 'bg-indigo-100 text-indigo-600 font-bold' : 'bg-slate-100 text-slate-500'}`}>
                                                    #{tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Replacement Modal (The "Change Place" UI) */}
                    {replacementModal.show && (
                        <div className="fixed inset-0 z-[120] bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center sm:p-4">
                            <div className="bg-white rounded-t-[2rem] sm:rounded-[2rem] w-full max-w-sm max-h-[85vh] overflow-hidden flex flex-col shadow-2xl animate-slide-up">
                                <div className="p-6 border-b bg-gradient-to-r from-indigo-50 to-white">
                                    <div className="flex justify-between items-center mb-1">
                                        <h3 className="font-bold text-lg text-indigo-900 flex items-center gap-2">
                                            <i data-lucide="sparkles" className="text-indigo-500 w-5 h-5"></i> AI Ï∂îÏ≤ú Ïû•ÏÜå
                                        </h3>
                                        <button onClick={() => setReplacementModal({ ...replacementModal, show: false })} className="p-1 rounded-full hover:bg-gray-100">
                                            <i data-lucide="x" className="w-5 h-5 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <p className="text-xs text-gray-500">6ÏÑ∏ ÏïÑÏù¥ÏôÄ Í∞ÄÏ°± Ï∑®Ìñ•ÏùÑ Í≥†Î†§Ìï¥ ÏÉàÎ°ú Ï∞æÏïòÏñ¥Ïöî!</p>
                                </div>
                                <div className="p-6 overflow-y-auto space-y-4 bg-slate-50">
                                    {replacementModal.alternatives.map((alt, idx) => (
                                        <div key={idx} onClick={() => applyReplacement(alt)} 
                                            className="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:border-indigo-500 hover:ring-1 hover:ring-indigo-500 cursor-pointer transition-all active:scale-95 group">
                                            <div className="flex justify-between items-start mb-2">
                                                <h4 className="font-bold text-gray-800 group-hover:text-indigo-600">{alt.title}</h4>
                                                <span className="text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded-full font-medium">ÏÑ†ÌÉù</span>
                                            </div>
                                            <p className="text-xs text-gray-600 mb-2">{alt.desc}</p>
                                            <div className="flex gap-1 flex-wrap">
                                                {alt.tags.map(t => <span key={t} className="text-[9px] text-gray-400 bg-gray-50 px-1.5 py-0.5 rounded">#{t}</span>)}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Chat Modal */}
                    {isChatOpen && (
                        <div className="fixed inset-0 z-[110] bg-white flex flex-col">
                            <div className="bg-slate-900 p-4 flex justify-between items-center text-white">
                                <div className="flex items-center gap-2">
                                    <div className="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center"><i data-lucide="bot"></i></div>
                                    <span className="font-bold">Ïó¨Ìñâ ÎπÑÏÑú</span>
                                </div>
                                <button onClick={() => setIsChatOpen(false)}><i data-lucide="chevron-down" className="w-6 h-6"></i></button>
                            </div>
                            <div className="flex-1 p-4 space-y-4 overflow-y-auto bg-slate-100 pb-20">
                                {chatMessages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`p-3 rounded-2xl text-sm leading-relaxed max-w-[80%] shadow-sm ${m.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white text-gray-800 rounded-tl-none'}`}>
                                            {m.text}
                                        </div>
                                    </div>
                                ))}
                                {isTyping && <div className="flex justify-start"><div className="bg-white p-3 rounded-2xl rounded-tl-none text-xs text-gray-400 shadow-sm flex items-center gap-1">ÏÉùÍ∞Å Ï§ë<span className="animate-bounce">.</span><span className="animate-bounce delay-100">.</span><span className="animate-bounce delay-200">.</span></div></div>}
                            </div>
                            <div className="p-3 border-t bg-white absolute bottom-0 w-full max-w-md">
                                <div className="flex gap-2">
                                    <input type="text" value={userInput} onChange={e => setUserInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleSendChat()} 
                                        placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." className="flex-1 px-4 py-3 bg-gray-100 rounded-full text-sm outline-none focus:ring-2 focus:ring-indigo-500" />
                                    <button onClick={handleSendChat} className="p-3 bg-indigo-600 text-white rounded-full shadow-md active:scale-95 transition-transform"><i data-lucide="send" className="w-5 h-5"></i></button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Floating Action Buttons */}
                    <div className="fixed bottom-6 right-6 flex flex-col gap-3 z-40">
                         <button onClick={() => setShowSummary(true)} className="w-12 h-12 bg-white text-gray-700 rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 border border-gray-200">
                            <i data-lucide="list"></i>
                        </button>
                        <button onClick={() => setIsChatOpen(true)} className="w-14 h-14 bg-slate-900 text-white rounded-full shadow-xl flex items-center justify-center hover:scale-105 transition-transform">
                            <i data-lucide="message-circle" className="w-6 h-6"></i>
                            <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></div>
                        </button>
                    </div>

                    {/* Settings Modal (API Key) */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[150] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-sm">
                                <h2 className="text-lg font-bold mb-4">üîë API ÌÇ§ ÏûÖÎ†•</h2>
                                <p className="text-xs text-gray-500 mb-4">Gemini API ÌÇ§Í∞Ä ÏûàÏñ¥Ïïº AI Ï∂îÏ≤ú Î∞è Ï±ÑÌåÖÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
                                <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="API Key" className="w-full px-4 py-2 border rounded-lg mb-4 text-sm" />
                                <div className="flex gap-2">
                                    <button onClick={() => saveApiKey(apiKey)} className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-bold text-sm">Ï†ÄÏû•</button>
                                    <button onClick={() => setShowSettings(false)} className="flex-1 py-3 bg-gray-200 text-gray-600 rounded-lg font-bold text-sm">Îã´Í∏∞</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Summary Modal */}
                    {showSummary && (
                        <div className="fixed inset-0 z-[130] bg-black/60 backdrop-blur-sm flex items-center justify-center p-6">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-sm max-h-[70vh] overflow-y-auto">
                                <h2 className="text-lg font-bold mb-4 border-b pb-2">üìÖ Ï†ÑÏ≤¥ ÏùºÏ†ï</h2>
                                {trip.itinerary.map(day => (
                                    <div key={day.day} className="mb-4">
                                        <h4 className="font-bold text-blue-600 text-sm mb-2">{day.date}</h4>
                                        <ul className="space-y-2">
                                            {day.schedule.map(s => (
                                                <li key={s.id} className="text-xs flex gap-2">
                                                    <span className="text-gray-400 font-mono w-10">{s.time}</span>
                                                    <span>{s.options[s.selectedOptionIndex].title}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                ))}
                                <button onClick={() => setShowSummary(false)} className="w-full py-3 bg-gray-800 text-white rounded-xl mt-4 text-sm">Îã´Í∏∞</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
